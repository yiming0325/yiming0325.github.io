<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yiming&#39;s blog</title>
  
  <subtitle>Hello,world</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://yiming0325.com/"/>
  <updated>2019-10-24T15:22:54.519Z</updated>
  <id>https://yiming0325.com/</id>
  
  <author>
    <name>YimingYuan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Samba服务器配置</title>
    <link href="https://yiming0325.com/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/"/>
    <id>https://yiming0325.com/Samba服务器配置/</id>
    <published>2019-10-24T15:11:04.000Z</published>
    <updated>2019-10-24T15:22:54.519Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x00实验背景"><a href="#0x00实验背景" class="headerlink" title="0x00实验背景"></a>0x00实验背景</h3><p>windows的匿名用户叫guest<br>linux的匿名用户叫anonymous</p><p>Linux 中有两种主要协议可用访问网络文件系统 : NFS 和CIFS 。 NFS ( Network File System ) 可看作是 Linux 、UNIX 及其它类似操作系统的标准文件系统。 CIFS( Comon Internet File System ) 则是针对 Microsoft Windows 系统的标准网络文件系统</p><p>CIFS: 通用网络文件系统:<br>CIFS 是针对 Microsoft Windows 操作系统的本地网络文件系统。<br>Linux 系统可以挂载和访问 CIFS 文件共享 , 如同常见的网络文件系统一样。然而 , 由于CIFS 是基于 NTFS 文件系统权限模型及其自身的身份验证系统来构建的 , 因而 CIFS 协&gt;议中的所有内容并不能很好地映射到 Linux 中 samba-client RPM 软件包所包含的 smbclient 实用程序可用来识别由 Windows 或 Samba 文件服务器提供的 CIFS 共享。该实用程序工作起来犹如在 Microsoft Windows 中单击网上邻居。然后 mount命令可用于挂载共享，访问 CIFS 共享的命令</p><p>提供cifs协议实现共享文件</p><h3 id="0x01实验环境"><a href="#0x01实验环境" class="headerlink" title="0x01实验环境"></a>0x01实验环境</h3><h4 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h4><p>系统版本：rhel7.3</p><p>IP：172.25.254.100</p><h3 id="0x02功能实现"><a href="#0x02功能实现" class="headerlink" title="0x02功能实现"></a>0x02功能实现</h3><h4 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum search samba</span><br><span class="line">yum install samba-client.x86_64  samba-common.x86_64  samba.x86_64  -y</span><br><span class="line">samba-client.x86_64  ###samba客户端程序</span><br><span class="line">samba.x86_64  ###samba服务器程序</span><br><span class="line">samba-common.x86_64 ###samba支持文件</span><br><span class="line"></span><br><span class="line">systemctl start smb</span><br><span class="line"></span><br><span class="line">netstat -antlpe |grep smb  ###samba服务器端口默认是开放的</span><br><span class="line">tcp        0      0 0.0.0.0:445             0.0.0.0:*               LISTEN      0          105291     2887/smbd</span><br><span class="line">tcp        0      0 0.0.0.0:139             0.0.0.0:*               LISTEN      0          105292     2887/smbd</span><br><span class="line">tcp6       0      0 :::445                  :::*                    LISTEN      0          105289     2887/smbd</span><br><span class="line">tcp6       0      0 :::139                  :::*                    LISTEN      0          105290     2887/smbd</span><br><span class="line"></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">smbpasswd -a student  ###添加samba服务器用户(samba的认证机制与系统不同，但是samba用户在系统中必须真实存在，密码可以不同)</span><br><span class="line">pdbedit -L  ###查看samba服务器用户</span><br><span class="line">pdbedit -x student ###删除samba服务器用户</span><br><span class="line"></span><br><span class="line">getsebool -a | grep samba</span><br><span class="line">setsebool -P samba_enable_home_dirs on ###开启samba用户进入自己家目录并建立文件&gt;的权力</span><br><span class="line"></span><br><span class="line">smbclient -L //172.25.254.100 -U student ###以samba用户student身份查看共享</span><br><span class="line">smbclient -L //172.25.254.100  ###以匿名身份查看共享</span><br><span class="line">smbclient //172.25.254.100/student -U student ###以samba用户student身份进入自己的家目录</span><br></pre></td></tr></table></figure><h4 id="samba共享目录的建立"><a href="#samba共享目录的建立" class="headerlink" title="samba共享目录的建立"></a>samba共享目录的建立</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /westos</span><br><span class="line">cd /westos</span><br><span class="line">touch westosfile&#123;1..10&#125;</span><br><span class="line"></span><br><span class="line">vim /etc/samba/smb.conf</span><br><span class="line">321         [westos]</span><br><span class="line">322         comment = local dir</span><br><span class="line">323         path = /westos</span><br><span class="line"></span><br><span class="line">systemctl restart smb.service</span><br><span class="line"></span><br><span class="line">smbclient -L //172.25.254.100</span><br><span class="line"></span><br><span class="line">semanage fcontext -a -t samba_share_t '/westos(/.*)?' ###修改安全上下文让用户可以进入查看,只针对该目录</span><br><span class="line">restorecon -RvvF /westos/</span><br><span class="line">或者：</span><br><span class="line">setsebool -P samba_export_all_rw on ###允许读写</span><br><span class="line">setsebool -P samba_export_all_ro on ###允许读</span><br><span class="line">一般建议修改安全上下文，不修改sebool值，sebool值的权限太大，而安全上下文只针对此</span><br><span class="line">目录</span><br><span class="line"></span><br><span class="line">smbclient //172.25.254.100/westos -U student</span><br></pre></td></tr></table></figure><h4 id="samba工作组名字的改变"><a href="#samba工作组名字的改变" class="headerlink" title="samba工作组名字的改变"></a>samba工作组名字的改变</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/samba/smb.conf</span><br><span class="line">89         workgroup = HEELO</span><br><span class="line"></span><br><span class="line">systemctl restart smb.service</span><br><span class="line">smbclient -L  //172.25.254.100</span><br></pre></td></tr></table></figure><h4 id="samba匿名访问"><a href="#samba匿名访问" class="headerlink" title="samba匿名访问"></a>samba匿名访问</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/samba/smb.conf</span><br><span class="line">321         [westos]</span><br><span class="line">322         comment = local dir</span><br><span class="line">323         guest ok = yes</span><br><span class="line">324         path = /westos</span><br><span class="line"></span><br><span class="line">systemctl restart smb.service</span><br><span class="line">smbclient //172.25.254.100/westos</span><br><span class="line"></span><br><span class="line">vim /etc/samba/smb.conf</span><br><span class="line">125         map to guest = bad user</span><br><span class="line"></span><br><span class="line">systemctl restart smb.service</span><br><span class="line">mount //172.25.254.100/westos  /mnt -o username=guest</span><br><span class="line"></span><br><span class="line">df</span><br><span class="line">Filesystem              1K-blocks    Used Available Use% Mounted on</span><br><span class="line">/dev/vda1                10473900 3157816   7316084  31% /</span><br><span class="line">devtmpfs                   481120       0    481120   0% /dev</span><br><span class="line">tmpfs                      496708     140    496568   1% /dev/shm</span><br><span class="line">tmpfs                      496708   13032    483676   3% /run</span><br><span class="line">tmpfs                      496708       0    496708   0% /sys/fs/cgroup</span><br><span class="line">//172.25.254.100/westos  10473900 3157816   7316084  31% /mnt</span><br></pre></td></tr></table></figure><h4 id="samba目录参数的管理"><a href="#samba目录参数的管理" class="headerlink" title="samba目录参数的管理"></a>samba目录参数的管理</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">允许挂载后修改</span><br><span class="line">vim /etc/samba/smb.conf</span><br><span class="line">321         [westos]</span><br><span class="line">322         comment = local dir</span><br><span class="line">323         guest ok = yes</span><br><span class="line">324         writable = yes</span><br><span class="line">325         path = /westos</span><br><span class="line"></span><br><span class="line">systemctl restart smb.service</span><br><span class="line"></span><br><span class="line">mount //172.25.254.100/westos /mnt -o username=student,password=123</span><br><span class="line"></span><br><span class="line">df</span><br><span class="line">Filesystem              1K-blocks    Used Available Use% Mounted on</span><br><span class="line">/dev/vda1                10473900 3158360   7315540  31% /</span><br><span class="line">devtmpfs                   481120       0    481120   0% /dev</span><br><span class="line">tmpfs                      496708     140    496568   1% /dev/shm</span><br><span class="line">tmpfs                      496708   13032    483676   3% /run</span><br><span class="line">tmpfs                      496708       0    496708   0% /sys/fs/cgroup</span><br><span class="line">//172.25.254.100/westos  10473900 3158360   7315540  31% /mnt</span><br><span class="line"></span><br><span class="line">cd /mnt</span><br><span class="line">chmod 777 /westos</span><br><span class="line">rm -fr westosfile1</span><br></pre></td></tr></table></figure><h4 id="只允许某一个人挂载后修改"><a href="#只允许某一个人挂载后修改" class="headerlink" title="只允许某一个人挂载后修改"></a>只允许某一个人挂载后修改</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/samba/smb.conf</span><br><span class="line">[westos]</span><br><span class="line">comment = local dir</span><br><span class="line">guest ok = yes</span><br><span class="line">write list = lee</span><br><span class="line"><span class="meta">#</span>writable = yes</span><br><span class="line">path = /westos</span><br><span class="line"></span><br><span class="line">useradd lee</span><br><span class="line">smbpasswd -a lee</span><br><span class="line">pdbedit -L</span><br><span class="line">systemctl restart smb.service</span><br><span class="line">mount //172.25.254.100/westos /mnt -o username=lee,password=123</span><br><span class="line">df</span><br><span class="line">cd /mnt</span><br><span class="line">rm -fr westosfile3</span><br></pre></td></tr></table></figure><h4 id="允许属于这个组的用户写"><a href="#允许属于这个组的用户写" class="headerlink" title="允许属于这个组的用户写"></a>允许属于这个组的用户写</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/samba/smb.conf</span><br><span class="line">write list = +lee       @lee</span><br></pre></td></tr></table></figure><h4 id="允许特定用户挂载"><a href="#允许特定用户挂载" class="headerlink" title="允许特定用户挂载"></a>允许特定用户挂载</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/samba/smb.conf</span><br><span class="line">valid users = lee</span><br></pre></td></tr></table></figure><h4 id="允许属于这个组的用户挂载"><a href="#允许属于这个组的用户挂载" class="headerlink" title="允许属于这个组的用户挂载"></a>允许属于这个组的用户挂载</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/samba/smb.conf</span><br><span class="line">valid users = +lee      @lee</span><br></pre></td></tr></table></figure><h4 id="是否允许被查看"><a href="#是否允许被查看" class="headerlink" title="是否允许被查看"></a>是否允许被查看</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/samba/smb.conf</span><br><span class="line">browseable = yes / no</span><br><span class="line">smbclient  -L //172.25.254.100</span><br></pre></td></tr></table></figure><h4 id="提升用户级别-协议中唯一一个）"><a href="#提升用户级别-协议中唯一一个）" class="headerlink" title="提升用户级别(协议中唯一一个）"></a>提升用户级别(协议中唯一一个）</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/samba/smb.conf</span><br><span class="line">admin users = lee 提升为root,但是建立文件后组仍然为lee</span><br></pre></td></tr></table></figure><h4 id="samba多用户挂载（可以避免非samba用户的访问，同时也可以实现建立文件的所有人所有组为认证后的samba用户）"><a href="#samba多用户挂载（可以避免非samba用户的访问，同时也可以实现建立文件的所有人所有组为认证后的samba用户）" class="headerlink" title="samba多用户挂载（可以避免非samba用户的访问，同时也可以实现建立文件的所有人所有组为认证后的samba用户）"></a>samba多用户挂载（可以避免非samba用户的访问，同时也可以实现建立文件的所有人所有组为认证后的samba用户）</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mount //172.25.254.100/westos -o username=lee,password=123 挂载，写文件时所有人&gt;和所有组均与服务器上的leeID一致，而多用户挂载mount //172.25.254.100/westos -o credentials=/root/smbpassfile,multiusermsec=ntlmssp，可以实现不同用户建立的文件所&gt;有人所有组都与各自的一致</span><br><span class="line">多用户认证时看的是用户名和密码</span><br><span class="line">多用户挂载建立文件后看文件所有人，看的是id与samba服务器用户samba服务器用户id相同</span><br><span class="line">的用户，遵循samba服务器的id</span><br><span class="line"></span><br><span class="line">准备一台虚拟机ip101配置好yum源，在samba服务器上注释掉guest ok = yes,禁止匿名用户</span><br><span class="line">登陆</span><br><span class="line"></span><br><span class="line">cifscreds clearall ##清除认证信息</span><br><span class="line">cifscreds add  IP  ##认证</span><br><span class="line">在101上</span><br><span class="line">yum install cifs-utils -y   ###此软件包包括cifscreds命令</span><br><span class="line"></span><br><span class="line">vim /root/smbpassfile   ###建立smb认证文件</span><br><span class="line">username=lee   ###samba用户</span><br><span class="line">password=123  ###samba用户密码</span><br><span class="line"></span><br><span class="line">chmod 600 /root/smbpassfile</span><br><span class="line">mount  //172.25.254.100/westos /mnt -o credentials=/root/smbpassfile,multiuser,sec=ntlmssp   ###多用户挂载</span><br><span class="line">mount ###查看挂载情况</span><br><span class="line"></span><br><span class="line">useradd kiosk</span><br><span class="line">su - kiosk</span><br><span class="line">cd /mnt</span><br><span class="line">ls   ###查看失败</span><br><span class="line">cifscreds add 172.25.254.100</span><br><span class="line"></span><br><span class="line">useradd lee</span><br><span class="line">su - lee</span><br><span class="line">cd /mnt</span><br><span class="line">ls ###查看失败</span><br><span class="line">cifscreds add 172.25.254.100    ###认证</span><br><span class="line">ls ###查看成功</span><br><span class="line"></span><br><span class="line">(samba服务器端root用户将westos权限设为777)</span><br><span class="line">cd /mnt</span><br><span class="line">touch lll</span><br><span class="line">ls</span><br><span class="line">-rw-r--r--. 1 kiosk   kiosk   0 Mar 21 07:39 lll   ###所有人所有组之所以为kiosk&gt;，因为kiosk在101上的id与服务器上lee的id一致</span><br></pre></td></tr></table></figure><h4 id="实现开机自动挂载："><a href="#实现开机自动挂载：" class="headerlink" title="实现开机自动挂载："></a>实现开机自动挂载：</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/fstab</span><br><span class="line">//172.25.254.100/westos /mnt cifs credentials=/root/smbpassfile,multiuser,sec=ntlmssp</span><br><span class="line"></span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;0x00实验背景&quot;&gt;&lt;a href=&quot;#0x00实验背景&quot; class=&quot;headerlink&quot; title=&quot;0x00实验背景&quot;&gt;&lt;/a&gt;0x00实验背景&lt;/h3&gt;&lt;p&gt;windows的匿名用户叫guest&lt;br&gt;linux的匿名用户叫anonymous&lt;/p&gt;
      
    
    </summary>
    
      <category term="Linux" scheme="https://yiming0325.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://yiming0325.com/tags/Linux/"/>
    
      <category term="Samba" scheme="https://yiming0325.com/tags/Samba/"/>
    
  </entry>
  
  <entry>
    <title>NFS服务器配置</title>
    <link href="https://yiming0325.com/NFS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/"/>
    <id>https://yiming0325.com/NFS服务器配置/</id>
    <published>2019-10-24T14:09:14.000Z</published>
    <updated>2019-10-24T15:25:05.630Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x00实验背景"><a href="#0x00实验背景" class="headerlink" title="0x00实验背景"></a>0x00实验背景</h3><p>NFS : 网络文件系统:<br>NFS ( Network File System ) 是由 Linux 、 UNIX 及其他类似操作系统使用的互联网标准协议 , 可作为它们的本地网络文件系统。它是一种活动扩展之下的开放标准 , 可支持本地 Linux 权限和文件系统功能</p><h3 id="0x01实验环境"><a href="#0x01实验环境" class="headerlink" title="0x01实验环境"></a>0x01实验环境</h3><h4 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h4><p>系统版本：rhel7.3</p><p>IP：172.25.254.1</p><p>其他：关闭防火墙</p><h3 id="0x02功能实现"><a href="#0x02功能实现" class="headerlink" title="0x02功能实现"></a>0x02功能实现</h3><h4 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum search nfs</span><br><span class="line">yum install nfs-utils.x86_64 -y  ###安装软件包</span><br><span class="line">systemctl start nfs</span><br><span class="line">如果没有关闭防火墙：</span><br><span class="line">firewall-cmd --permanent --add-service=nfs</span><br><span class="line">firewall-cmd --permanent --add-service=rpc-bind</span><br><span class="line">firewall-cmd --permanent --add-service=mountd</span><br><span class="line">测试：</span><br><span class="line">showmount -e 172.25.254.1</span><br></pre></td></tr></table></figure><h4 id="建立共享目录并配置参数"><a href="#建立共享目录并配置参数" class="headerlink" title="建立共享目录并配置参数"></a>建立共享目录并配置参数</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">mkdir /westos</span><br><span class="line"></span><br><span class="line">vim /etc/exports</span><br><span class="line">/westos  *(ro)     ###对目录可读</span><br><span class="line">/westos  *(rw)    ###对目录可读写,需要chmod 777 /westos</span><br><span class="line">/westos   *(rw,sync,no_root_squash)   ###当NFC客户端使用root用户访问时，映射为NFS客户</span><br><span class="line">端的root用户,默认为65534的nfsnobody用户;sync：同步写入资料到内存与硬盘中 async：资料会暂存到内存中，而非直接写入硬盘 （大容量数据）</span><br><span class="line"></span><br><span class="line">exportfs -rv   ###使更改生效</span><br><span class="line">测试：</span><br><span class="line">showmount -e 172.25.254.1</span><br><span class="line">mount 172.25.254.1:/westos /mnt</span><br></pre></td></tr></table></figure><h4 id="使用指定版本挂载"><a href="#使用指定版本挂载" class="headerlink" title="使用指定版本挂载"></a>使用指定版本挂载</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mount -o vers=3 172.25.254.1:/westos  /mnt  ###使用指定的NFS版本进行挂载</span><br><span class="line">mount  ###查看挂载版本</span><br></pre></td></tr></table></figure><h4 id="设置开机自动挂载"><a href="#设置开机自动挂载" class="headerlink" title="设置开机自动挂载"></a>设置开机自动挂载</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim /etc/fstab</span><br><span class="line">172.25.254.1：/westos  /mnt nfs  defaults  0 0</span><br></pre></td></tr></table></figure><h4 id="设置智能挂载"><a href="#设置智能挂载" class="headerlink" title="设置智能挂载"></a>设置智能挂载</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install autofs   ###安装autofs软件</span><br><span class="line">systemctl status autofs</span><br><span class="line">systemctl start autofs</span><br><span class="line">systemctl status autofs</span><br><span class="line">ll -d  /net</span><br><span class="line">cd /net</span><br><span class="line">cd 172.25.254.1</span><br><span class="line">cd westos/</span><br></pre></td></tr></table></figure><h4 id="更改智能挂载目录和策略"><a href="#更改智能挂载目录和策略" class="headerlink" title="更改智能挂载目录和策略"></a>更改智能挂载目录和策略</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim /etc/auto.master</span><br><span class="line">14 /mnt    /etc/auto.mnt</span><br><span class="line"></span><br><span class="line">vim /etc/auto.mnt</span><br><span class="line">westos  172.25.254.1:/westos</span><br><span class="line"></span><br><span class="line">systemctl restart autofs</span><br><span class="line">cd /mnt</span><br><span class="line">cd westos</span><br></pre></td></tr></table></figure><h4 id="挂载多目录的方式："><a href="#挂载多目录的方式：" class="headerlink" title="挂载多目录的方式："></a>挂载多目录的方式：</h4><p>注：这时自动卸载时间会失效</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim /etc/auto.mnt</span><br><span class="line">*     172.25.254.1:/westos/&amp;      ###将172.25.254.1/westos目录下的westos1/,westos2/..分别挂载到本机/mnt/westos1 ......</span><br><span class="line">systemctl restart autofs</span><br><span class="line">cd /mnt</span><br><span class="line">ls</span><br><span class="line">cd westos1</span><br><span class="line">cd ..</span><br><span class="line">cd westos2</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;0x00实验背景&quot;&gt;&lt;a href=&quot;#0x00实验背景&quot; class=&quot;headerlink&quot; title=&quot;0x00实验背景&quot;&gt;&lt;/a&gt;0x00实验背景&lt;/h3&gt;&lt;p&gt;NFS : 网络文件系统:&lt;br&gt;NFS ( Network File System ) 是
      
    
    </summary>
    
      <category term="Linux" scheme="https://yiming0325.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://yiming0325.com/tags/Linux/"/>
    
      <category term="NFS" scheme="https://yiming0325.com/tags/NFS/"/>
    
  </entry>
  
  <entry>
    <title>Apache服务器配置</title>
    <link href="https://yiming0325.com/Apache%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/"/>
    <id>https://yiming0325.com/Apache服务器配置/</id>
    <published>2019-10-20T16:27:38.000Z</published>
    <updated>2019-10-24T15:08:49.935Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x00实验背景"><a href="#0x00实验背景" class="headerlink" title="0x00实验背景"></a>0x00实验背景</h3><p> Apache是世界使用排名第一的Web服务器软件。它可以运行在几乎所有广泛使用的计算机平台上，由于其跨平台和安全性被广泛使用，是最流行的Web服务器端软件之一。它快速、可靠并且可通过简单的API扩充，将Perl/Python等解释器编译到服务器中。</p><h3 id="0x01实验环境"><a href="#0x01实验环境" class="headerlink" title="0x01实验环境"></a>0x01实验环境</h3><h4 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h4><p>系统版本：rhel7.0<br>IP:172.25.28.1<br>其他：关闭firewalld</p><h3 id="0x02功能实现"><a href="#0x02功能实现" class="headerlink" title="0x02功能实现"></a>0x02功能实现</h3><h4 id="apache安装部署"><a href="#apache安装部署" class="headerlink" title="apache安装部署"></a>apache安装部署</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install httpd -y </span><br><span class="line">yum install httpd-manual -y</span><br><span class="line">测试：</span><br><span class="line">http://172.25.28.1/</span><br><span class="line">http://172.25.28.1/manual</span><br></pre></td></tr></table></figure><h4 id="apache基础信息"><a href="#apache基础信息" class="headerlink" title="apache基础信息"></a>apache基础信息</h4><p>主配置目录：    /etc/httpd/conf<br>主配置文件：    /etc/httpd/conf/httpd.conf<br>子配置目录：    /etc/httpd/conf.d/<br>子配置文件：    /etc/httpd/conf.d/.conf<br>默认发布目录：    /var/www/html<br>默认发布文件：    index.html<br>默认端口：    80 443<br>默认安全上下文：httpd_sys_content_t<br>程序开启默认用户： apache<br>apache日志：    /etc/httpd/logs/</p><h4 id="修改默认端口"><a href="#修改默认端口" class="headerlink" title="修改默认端口"></a>修改默认端口</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/httpd/conf/httpd.conf </span><br><span class="line"> 42 Listen 8080</span><br></pre></td></tr></table></figure><h4 id="修改默认发布文件"><a href="#修改默认发布文件" class="headerlink" title="修改默认发布文件"></a>修改默认发布文件</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/httpd/conf/httpd.conf </span><br><span class="line">164     DirectoryIndex test.html index.html</span><br></pre></td></tr></table></figure><h4 id="修改默认发布目录"><a href="#修改默认发布目录" class="headerlink" title="修改默认发布目录"></a>修改默认发布目录</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/httpd/conf/httpd.conf </span><br><span class="line">120 DocumentRoot "/www/html"</span><br><span class="line">121 &lt;Directory "/www"&gt;</span><br><span class="line">122         Require all granted</span><br><span class="line">123 &lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">semanage fcontext -a -t httpd_sys_content_t '/www(/.*)?'</span><br><span class="line">rstorecon -RvvF /www/</span><br></pre></td></tr></table></figure><h4 id="apache虚拟主机"><a href="#apache虚拟主机" class="headerlink" title="apache虚拟主机"></a>apache虚拟主机</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/default.conf </span><br><span class="line">&lt;VirtualHost _default_:80&gt;</span><br><span class="line">        DocumentRoot "/var/www/html"</span><br><span class="line">        CustomLog "logs/www.linux.com.log" combined  \combine表示四种日志的集合</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">vim /etc/httpd/conf.d/hello.conf </span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">        ServerName www.world.com</span><br><span class="line">        DocumentRoot "/hello/"</span><br><span class="line">        CustomLog "logs/wwww.world.com.log" combined</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory "/hello"&gt;</span><br><span class="line">        Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">测试：</span><br><span class="line">在测试主机中做好本地解析:</span><br><span class="line">vim /etc/hosts</span><br><span class="line">172.25.28.1 www.linux.com www.world.com</span><br></pre></td></tr></table></figure><h4 id="apache访问控制"><a href="#apache访问控制" class="headerlink" title="apache访问控制"></a>apache访问控制</h4><h5 id="针对主机的访问控制"><a href="#针对主机的访问控制" class="headerlink" title="针对主机的访问控制"></a>针对主机的访问控制</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;Directory /var/www/hello&gt;</span><br><span class="line">        Order deny,allow</span><br><span class="line">        Deny from all</span><br><span class="line">        Allow from 172.25.254.3</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure><h5 id="针对用户的访问控制"><a href="#针对用户的访问控制" class="headerlink" title="针对用户的访问控制"></a>针对用户的访问控制</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">htpasswd -cm    /etc/httpd/userpass     admin</span><br><span class="line">htpasswd -m     /etc/httpd/userpass     admin1</span><br><span class="line"></span><br><span class="line">vim adefault.conf</span><br><span class="line">&lt;Directory "/var/www/html/admin"&gt;</span><br><span class="line">        AuthUserFile /etc/httpd/userpass</span><br><span class="line">        AuthName "Please input your name and password"</span><br><span class="line">        AuthType basic</span><br><span class="line">        #Require        user admin</span><br><span class="line">        Require valid-user</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure><h4 id="apache支持的语言"><a href="#apache支持的语言" class="headerlink" title="apache支持的语言"></a>apache支持的语言</h4><h5 id="1-html"><a href="#1-html" class="headerlink" title="1.html"></a>1.html</h5><h5 id="2-php"><a href="#2-php" class="headerlink" title="2.php"></a>2.php</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /var/www/html/index.php</span><br><span class="line">&lt;?php</span><br><span class="line">        phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">yum install php -y</span><br><span class="line">systemctl restart httpd</span><br><span class="line">测试</span><br><span class="line">172.25.254.100/index.php</span><br></pre></td></tr></table></figure><h5 id="3-cgi"><a href="#3-cgi" class="headerlink" title="3.cgi"></a>3.cgi</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /var/www/html/cgi</span><br><span class="line">semanager fcontent -a -t  httpd_sys_script_exec_t '/var/www/html/cgi(/.*)?'</span><br><span class="line">restorecon -RvvF /var/www/html/cgi/</span><br><span class="line">vim /var/www/html/cgi/index.cgi</span><br><span class="line"><span class="meta">#</span>!/usr/bin/perl</span><br><span class="line">print "Content-type: text/html\n\n";</span><br><span class="line">print `date`;</span><br><span class="line"></span><br><span class="line">chmod +x /var/www/html/cgi/index.cgi</span><br><span class="line">/var/www/html/cgi/index.cgi     #执行下脚本确保脚本运行正常</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim adefatul.conf</span><br><span class="line">&lt;Directory "/var/www/html/cgi"&gt;</span><br><span class="line">        Options +ExecCGI</span><br><span class="line">        AddHandler cgi-script .cgi</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">systemctl restart httpd</span><br></pre></td></tr></table></figure><h5 id="4-wsgi"><a href="#4-wsgi" class="headerlink" title="4.wsgi"></a>4.wsgi</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install mod_wsgi -y</span><br><span class="line">vim /var/www/html/cgi/westos.wsgi</span><br><span class="line"><span class="meta">#</span>!/usr/bin/env python</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def application (environ, start_response):</span><br><span class="line">  response_body = 'UNIX EPOCH time is now: %s\n' % time.time()</span><br><span class="line">  status = '200 OK'</span><br><span class="line">  response_headers = [('Content-Type', 'text/plain'),</span><br><span class="line">                      ('Content-Length', '1'),</span><br><span class="line">                      ('Content-Length', str(len(response_body)))]</span><br><span class="line">  start_response(status, response_headers)</span><br><span class="line">  return [response_body]</span><br><span class="line"></span><br><span class="line">vim /etc/httpd/conf.d/adefault.conf</span><br><span class="line">&lt;VirtualHost _default_:80&gt;</span><br><span class="line">        DocumentRoot "/var/www/html"</span><br><span class="line">        WSGIScriptAlias /WSGI   /var/www/html/cgi/script.wsgi</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">systemctl restart httpd</span><br><span class="line"></span><br><span class="line">测试：</span><br><span class="line">http://172.25.28.1/WSGI</span><br></pre></td></tr></table></figure><h4 id="设定https虚拟主机并设定网页重写"><a href="#设定https虚拟主机并设定网页重写" class="headerlink" title="设定https虚拟主机并设定网页重写"></a>设定https虚拟主机并设定网页重写</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;VirtualHost *:443&gt;</span><br><span class="line">        ServerName login.westos.com</span><br><span class="line">        DocumentRoot /var/www/html/virtual/login.westos.com/html</span><br><span class="line">        CustomLog "logs/login.logs" combined</span><br><span class="line">        SSLEngine on</span><br><span class="line">        SSLCertificateFile /etc/pki/tls/certs/www.westos.com.crt</span><br><span class="line">        SSLCertificateKeyFile /etc/pki/tls/private/www.westos.com.key</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line">&lt;Directory "/var/www/html/virtual/login.westos.com/html"&gt;</span><br><span class="line">        Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">        ServerName login.westos.com</span><br><span class="line">        RewriteEngine On</span><br><span class="line">        RewriteRule ^(/.*)$ https://%&#123;HTTP_HOST&#125;$1 [redirect=301]</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">^(/.*)$         ##客户在浏览器地址栏中输入的所有字符</span><br><span class="line">https://        ##强制客户加密访问</span><br><span class="line"><span class="meta">%</span>&#123;HTTP_HOST&#125;    ##客户请求主机</span><br><span class="line"><span class="meta">$</span>1              ###"$1"标示 ^(/.*)$的值</span><br><span class="line">[redirect=301]  ##永久重写 302临时</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;0x00实验背景&quot;&gt;&lt;a href=&quot;#0x00实验背景&quot; class=&quot;headerlink&quot; title=&quot;0x00实验背景&quot;&gt;&lt;/a&gt;0x00实验背景&lt;/h3&gt;&lt;p&gt; Apache是世界使用排名第一的Web服务器软件。它可以运行在几乎所有广泛使用的计算机平台
      
    
    </summary>
    
      <category term="Linux" scheme="https://yiming0325.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://yiming0325.com/tags/Linux/"/>
    
      <category term="Apache" scheme="https://yiming0325.com/tags/Apache/"/>
    
  </entry>
  
  <entry>
    <title>RHCE Milestone</title>
    <link href="https://yiming0325.com/RHCE-Milestone/"/>
    <id>https://yiming0325.com/RHCE-Milestone/</id>
    <published>2019-10-17T16:27:38.000Z</published>
    <updated>2019-10-17T16:34:20.314Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://user-images.githubusercontent.com/22051278/67028794-8ef1fa00-f13e-11e9-8b86-119c8ebfd009.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/22051278/67028794-8ef1fa00-f13e-11e9-8b86-119c8ebfd009.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

      
    
    </summary>
    
      <category term="Linux" scheme="https://yiming0325.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://yiming0325.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>虚拟机上网</title>
    <link href="https://yiming0325.com/%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E7%BD%91/"/>
    <id>https://yiming0325.com/虚拟机上网/</id>
    <published>2019-10-17T15:11:44.000Z</published>
    <updated>2019-10-18T12:22:24.813Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-实验背景"><a href="#0x00-实验背景" class="headerlink" title="0x00 实验背景"></a>0x00 实验背景</h1><p>linux虚拟机通过物理机访问外部网络</p><h1 id="0x01-实验环境"><a href="#0x01-实验环境" class="headerlink" title="0x01 实验环境"></a>0x01 实验环境</h1><h3 id="物理机"><a href="#物理机" class="headerlink" title="物理机"></a>物理机</h3><p>系统版本: RHEL7.3</p><p>IP:172.25.254.1</p><p>网络配置方式：桥接</p><h3 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h3><p>系统版本：RHEL7.0</p><p>IP:172.25.254.2</p><h1 id="0x02-实验步骤"><a href="#0x02-实验步骤" class="headerlink" title="0x02 实验步骤"></a>0x02 实验步骤</h1><h3 id="虚拟机-1"><a href="#虚拟机-1" class="headerlink" title="虚拟机"></a>虚拟机</h3><p>开启防火防并且利用防火墙打开地址伪装</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --add-masquerade</span><br></pre></td></tr></table></figure><p>打开内核路由功能</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# sysctl -a | grep ip_forward</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">如果未开启：</span><br><span class="line">[root@localhost ~]# vim /etc/sysctl.conf </span><br><span class="line">net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure><p>设置网关</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/sysconfig/network</span><br><span class="line">GATEWAY=172.25.254.1</span><br></pre></td></tr></table></figure><p>设置DNS</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/resolv.conf </span><br><span class="line">nameserver 114.114.114.114</span><br></pre></td></tr></table></figure><h3 id="物理机-1"><a href="#物理机-1" class="headerlink" title="物理机"></a>物理机</h3><p>开启防火墙，并且利用防火墙打开地址伪装</p><p>打开内核的路由功能</p><h1 id="0x03-测试"><a href="#0x03-测试" class="headerlink" title="0x03 测试"></a>0x03 测试</h1><p>在虚拟机上ping baidu.com</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;0x00-实验背景&quot;&gt;&lt;a href=&quot;#0x00-实验背景&quot; class=&quot;headerlink&quot; title=&quot;0x00 实验背景&quot;&gt;&lt;/a&gt;0x00 实验背景&lt;/h1&gt;&lt;p&gt;linux虚拟机通过物理机访问外部网络&lt;/p&gt;
&lt;h1 id=&quot;0x01-实验环境&quot;
      
    
    </summary>
    
      <category term="Linux" scheme="https://yiming0325.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://yiming0325.com/tags/Linux/"/>
    
      <category term="虚拟机" scheme="https://yiming0325.com/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    
  </entry>
  
</feed>
